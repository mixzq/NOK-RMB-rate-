#!/usr/bin/env node

require('dotenv').config()

const os = require('os')
const path = require('path')
const debug = require('debug')('sendgrid-mail')
const sgSendmail = require('./lib/sendmail')
const setConfig = require('./lib/set_config')
const util = require('./lib/util')
const cli = require('./lib/cli')

if (require.main === module) {
  (async () => {
    // Because we're in command-line mode, get configuration from an rc file.
    const configFile = path.join(os.homedir(), '.sendgrid-mailrc')
    await setConfig(configFile)

    const options = await cli.init()
    debug(`command line options: ${util.inspect(options)}`)

    await sgSendmail(options)
    debug('OK')
  })()
}

module.exports = sgSendmail
